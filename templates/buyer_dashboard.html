{% extends "layout.html" %}
{% block title %}Product Catalog{% endblock %}
{% block content %}

<div class="space-y-8 animate-fade-in">
    
    <div class="flex flex-col md:flex-row justify-between items-end gap-4">
        <div>
            <h1 class="text-3xl font-bold text-white tracking-tight">Marketplace</h1>
            <p class="text-gray-400 text-sm mt-1">Browse premium developer gear and software.</p>
        </div>
        <div class="flex space-x-3">
            <a hx-get="{{ url_for('buyer.my_orders') }}" 
               hx-target="#main-content" hx-select="#main-content" hx-push-url="true" hx-swap="outerHTML transition:true"
               class="glass-panel px-4 py-2 rounded-lg text-gray-300 hover:text-white text-sm font-medium transition-all cursor-pointer">
                Orders
            </a>
            <a hx-get="{{ url_for('buyer.view_cart') }}" 
               hx-target="#main-content" hx-select="#main-content" hx-push-url="true" hx-swap="outerHTML transition:true"
               class="px-5 py-2 bg-indigo-600 hover:bg-indigo-500 text-white rounded-lg shadow-lg shadow-indigo-500/20 text-sm font-bold transition-all flex items-center cursor-pointer">
                <i class="fas fa-shopping-cart mr-2"></i> View Cart
            </a>
        </div>
    </div>

    <div class="relative group">
        <div class="flex space-x-3 overflow-x-auto pb-2 custom-scrollbar mask-fade-right">
            <a hx-get="{{ url_for('buyer.buyer_dashboard') }}" 
               hx-target="#main-content" hx-select="#main-content" hx-push-url="true"
               class="whitespace-nowrap px-5 py-2 rounded-full text-sm font-medium transition-all border cursor-pointer {{ 'bg-white text-black border-white' if not current_category else 'bg-white/5 text-gray-400 border-white/10 hover:bg-white/10 hover:text-white' }}">
               All Products
            </a>
            {% for cat in categories %}
            <a hx-get="{{ url_for('buyer.buyer_dashboard', category=cat) }}" 
               hx-target="#main-content" hx-select="#main-content" hx-push-url="true"
               class="whitespace-nowrap px-5 py-2 rounded-full text-sm font-medium transition-all border cursor-pointer {{ 'bg-white text-black border-white' if current_category == cat else 'bg-white/5 text-gray-400 border-white/10 hover:bg-white/10 hover:text-white' }}">
               {{ cat }}
            </a>
            {% endfor %}
        </div>
        <div class="absolute right-0 top-0 bottom-2 w-12 bg-gradient-to-l from-[#0f172a] to-transparent pointer-events-none md:hidden"></div>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6">
        {% for product in products %}
        <div class="group relative glass-panel rounded-2xl overflow-hidden transition-all duration-300 hover:-translate-y-1 hover:shadow-xl hover:shadow-indigo-500/10 border border-white/5 hover:border-indigo-500/30">
            
            <a hx-get="{{ url_for('buyer.product_detail_page', product_id=product.id) }}" 
               hx-target="#main-content" hx-select="#main-content" hx-push-url="true" hx-swap="outerHTML transition:true"
               class="block relative aspect-square bg-gray-800/50 overflow-hidden cursor-pointer">
               
                {% if product.image_url %}
                    <img src="{{ product.image_url }}" alt="{{ product.name }}" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-110">
                {% else %}
                    <div class="w-full h-full flex items-center justify-center text-gray-600">
                        <i class="fas fa-cube text-4xl opacity-30"></i>
                    </div>
                {% endif %}
                
                <div class="absolute top-3 left-3 flex flex-col gap-2">
                    {% if product.category %}
                        <span class="px-2 py-1 rounded-md bg-black/60 backdrop-blur-sm text-[10px] font-bold uppercase tracking-wider text-white border border-white/10">
                            {{ product.category }}
                        </span>
                    {% endif %}
                </div>
                
                {% if product.stock < 5 %}
                    <span class="absolute top-3 right-3 px-2 py-1 rounded-md bg-red-600 text-white text-[10px] font-bold shadow-lg animate-pulse">
                        Low Stock
                    </span>
                {% endif %}

                <div class="absolute inset-x-0 bottom-0 p-4 translate-y-full group-hover:translate-y-0 transition-transform duration-300 ease-out bg-gradient-to-t from-black/90 via-black/60 to-transparent pt-10">
                    <form action="{{ url_for('buyer.add_to_cart', product_id=product.id) }}" method="POST"
                          hx-post="{{ url_for('buyer.add_to_cart', product_id=product.id) }}"
                          hx-target="#main-content"
                          hx-select="#main-content"
                          hx-swap="outerHTML">
                        <button type="submit" class="w-full py-2.5 bg-white text-black font-bold rounded-lg hover:bg-gray-200 transition-colors text-sm flex items-center justify-center shadow-lg">
                            <i class="fas fa-plus mr-2"></i> Quick Add
                        </button>
                    </form>
                </div>
            </a>

            <div class="p-5">
                <div class="flex justify-between items-start mb-2">
                    <h3 class="text-base font-bold text-white leading-tight group-hover:text-indigo-400 transition-colors">
                        <a hx-get="{{ url_for('buyer.product_detail_page', product_id=product.id) }}" 
                           hx-target="#main-content" hx-select="#main-content" hx-push-url="true" hx-swap="outerHTML transition:true"
                           class="cursor-pointer">
                            {{ product.name }}
                        </a>
                    </h3>
                </div>
                
                <p class="text-xs text-gray-400 line-clamp-2 mb-4 h-8">{{ product.description or 'Premium quality item for developers.' }}</p>
                
                <div class="flex items-center justify-between border-t border-white/5 pt-3">
                    <span class="text-lg font-bold text-emerald-400">â‚¹{{ "{:,.2f}".format(product.price) }}</span>
                    <span class="text-[10px] text-gray-500 font-mono">{{ product.product_code }}</span>
                </div>
            </div>
        </div>
        {% else %}
        <div class="col-span-full py-16 text-center">
            <div class="inline-flex items-center justify-center w-20 h-20 rounded-full bg-white/5 mb-4 text-gray-500">
                <i class="fas fa-box-open text-3xl"></i>
            </div>
            <h3 class="text-xl font-bold text-white">No Products Found</h3>
            <p class="text-gray-400 mt-2">Check back later or try a different category.</p>
            <a hx-get="{{ url_for('buyer.buyer_dashboard') }}" 
               hx-target="#main-content" hx-select="#main-content" hx-push-url="true"
               class="inline-block mt-6 px-6 py-2 rounded-lg bg-white/10 hover:bg-white/20 text-white text-sm font-medium transition-all cursor-pointer">
               Clear Filters
            </a>
        </div>
        {% endfor %}
    </div>
</div>

<style>
    .mask-fade-right {
        -webkit-mask-image: linear-gradient(to right, black 90%, transparent 100%);
        mask-image: linear-gradient(to right, black 90%, transparent 100%);
    }
</style>
{% endblock %}