{% extends "layout.html" %}
{% block title %}Candidate Portal{% endblock %}
{% block content %}

<div class="space-y-8 animate-dynamic">

    <div class="flex flex-col md:flex-row justify-between items-end gap-4">
        <div>
            <h1 class="text-3xl font-bold text-white tracking-tight">Candidate Portal</h1>
            <p class="text-gray-400 text-sm mt-1">Track applications and showcase your skills.</p>
        </div>
        
        {% if current_user.meeting_link %}
        <a href="{{ current_user.meeting_link }}" target="_blank" class="group relative flex items-center px-6 py-3 bg-gradient-to-r from-indigo-600 to-blue-600 rounded-xl overflow-hidden shadow-lg shadow-indigo-500/30 transition-all hover:scale-[1.02]">
            <div class="absolute inset-0 bg-white/20 group-hover:translate-x-full transition-transform duration-500 ease-out -skew-x-12 origin-left"></div>
            <div class="mr-4 bg-white/20 p-2 rounded-full animate-pulse">
                <i class="fas fa-video text-white"></i>
            </div>
            <div class="text-left">
                <p class="text-xs text-indigo-200 font-bold uppercase tracking-wider">Action Required</p>
                <p class="text-sm font-bold text-white">Join Interview Session &rarr;</p>
            </div>
        </a>
        {% endif %}
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        
        <div class="lg:col-span-2 space-y-6">
            <div class="glass-panel rounded-xl overflow-hidden flex flex-col h-full">
                <div class="p-6 border-b border-white/5 flex justify-between items-center bg-white/5">
                    <h2 class="font-bold text-white flex items-center">
                        <i class="fas fa-briefcase text-emerald-400 mr-3"></i> Open Positions
                    </h2>
                    <span class="px-2.5 py-1 rounded-md bg-emerald-500/10 text-emerald-400 text-xs font-bold border border-emerald-500/20">
                        {{ open_jobs|length }} Active
                    </span>
                </div>
                
                <div class="p-6 grid gap-4">
                    {% for job in open_jobs %}
                    <div class="group relative bg-black/20 hover:bg-white/5 border border-white/5 hover:border-emerald-500/30 rounded-xl p-5 transition-all duration-300">
                        <div class="flex justify-between items-start">
                            <div>
                                <h3 class="text-lg font-bold text-white group-hover:text-emerald-300 transition-colors">{{ job.title }}</h3>
                                <p class="text-sm text-gray-400 mt-1 line-clamp-2">{{ job.description }}</p>
                                <div class="flex items-center gap-4 mt-3 text-xs text-gray-500 font-mono">
                                    <span><i class="fas fa-hashtag mr-1"></i>{{ job.job_id[:8] }}</span>
                                    <span><i class="far fa-clock mr-1"></i>{{ job.created_at.strftime('%b %d') }}</span>
                                </div>
                            </div>
                            
                            <div class="ml-4 flex-shrink-0">
                                {% if job.id in applied_job_ids %}
                                    <span class="inline-flex items-center px-3 py-1.5 rounded-lg bg-emerald-500/20 text-emerald-400 border border-emerald-500/30 text-xs font-bold">
                                        <i class="fas fa-check-circle mr-1.5"></i> Applied
                                    </span>
                                {% else %}
                                    <a href="{{ url_for('candidate.apply_job', job_id=job.id) }}" class="inline-flex items-center px-4 py-2 rounded-lg bg-white/5 hover:bg-emerald-600 text-white text-xs font-bold border border-white/10 hover:border-emerald-500 transition-all">
                                        Apply Now <i class="fas fa-arrow-right ml-2 opacity-0 group-hover:opacity-100 transition-opacity -translate-x-2 group-hover:translate-x-0"></i>
                                    </a>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-12">
                        <div class="inline-flex items-center justify-center w-16 h-16 rounded-full bg-gray-800 mb-4 text-gray-600">
                            <i class="fas fa-search text-2xl"></i>
                        </div>
                        <p class="text-gray-400">No open positions at the moment.</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="space-y-6">
            
            <div class="glass-panel rounded-xl p-6">
                <h2 class="font-bold text-white mb-4 flex items-center text-sm uppercase tracking-wide">
                    <i class="fas fa-file-signature text-indigo-400 mr-2"></i> Application Status
                </h2>
                <div class="space-y-3 max-h-[300px] overflow-y-auto custom-scrollbar pr-1">
                    {% for app in my_applications %}
                    <div class="p-3 rounded-lg bg-white/5 border border-white/5 flex items-center justify-between">
                        <div class="overflow-hidden">
                            <p class="text-sm font-semibold text-gray-200 truncate">{{ app.job.title }}</p>
                            <p class="text-[10px] text-gray-500">{{ app.applied_at.strftime('%b %d, %Y') }}</p>
                        </div>
                        <div class="flex-shrink-0 ml-2">
                            {% if app.status == 'accepted' %}
                                <i class="fas fa-check-circle text-emerald-400 text-lg" title="Accepted"></i>
                            {% elif app.status == 'rejected' %}
                                <i class="fas fa-times-circle text-red-400 text-lg" title="Rejected"></i>
                            {% else %}
                                <div class="w-4 h-4 rounded-full border-2 border-yellow-500 border-t-transparent animate-spin" title="Pending"></div>
                            {% endif %}
                        </div>
                    </div>
                    {% else %}
                    <p class="text-xs text-gray-500 text-center py-4">No active applications.</p>
                    {% endfor %}
                </div>
            </div>

            <div class="glass-panel rounded-xl overflow-hidden border border-white/10">
                <div class="bg-[#1e1e1e] px-4 py-2 border-b border-white/10 flex justify-between items-center">
                    <span class="text-xs text-gray-400 font-mono">share_snippet.java</span>
                    <div class="flex space-x-1.5">
                        <div class="w-2.5 h-2.5 rounded-full bg-red-500/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-yellow-500/50"></div>
                        <div class="w-2.5 h-2.5 rounded-full bg-green-500/50"></div>
                    </div>
                </div>
                <div class="p-5 bg-[#1e1e1e]">
                    <form action="{{ url_for('candidate.share_code') }}" method="POST" class="space-y-4">
                        <div>
                            <select name="recipient_id" class="w-full bg-white/5 border border-white/10 rounded-lg px-3 py-2 text-xs text-white focus:ring-1 focus:ring-indigo-500 font-mono">
                                <option value="">// Select Recipient...</option>
                                {% for user in messageable_users %}
                                    <option value="{{ user.id }}">@{{ user.username }} ({{ user.role }})</option>
                                {% endfor %}
                            </select>
                        </div>
                        <textarea name="java_code" rows="6" class="w-full bg-transparent border-0 text-gray-300 font-mono text-xs p-0 focus:ring-0 resize-none placeholder-gray-600" placeholder="public class Solution { ... }"></textarea>
                        <button type="submit" class="w-full py-2 rounded bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold font-mono transition-colors">
                            > Execute Share
                        </button>
                    </form>
                </div>
            </div>

        </div>
    </div>
</div>
{% endblock %}