{% extends "layout.html" %}
{% block title %}Candidate Dashboard{% endblock %}
{% block content %}

<div class="mb-10 animate-dynamic">
    <h1 class="text-4xl font-extrabold text-transparent bg-clip-text bg-gradient-to-r from-blue-400 to-indigo-400 mb-2">
        Candidate Portal
    </h1>
    <p class="text-gray-400 text-lg">Track your applications, take tests, and connect with the team.</p>
</div>

<div id="sortable-container" class="space-y-8">
    
    {% if current_user.meeting_link %}
    <div class="sortable-item bg-gradient-to-r from-indigo-900/80 to-blue-900/80 rounded-xl p-6 shadow-lg border border-indigo-500/30 animate-dynamic flex flex-col md:flex-row items-center justify-between gap-4">
        <div class="flex items-center">
            <div class="h-12 w-12 rounded-full bg-indigo-500/20 flex items-center justify-center mr-4 text-indigo-300">
                <i class="fas fa-video text-2xl"></i>
            </div>
            <div>
                <h2 class="text-xl font-bold text-white">Interview Scheduled</h2>
                <p class="text-indigo-200 text-sm">Your session is ready. Please join on time.</p>
            </div>
        </div>
        <a href="{{ current_user.meeting_link }}" target="_blank" class="px-6 py-3 bg-indigo-500 hover:bg-indigo-400 text-white font-bold rounded-lg shadow-lg transition-all transform hover:scale-105 whitespace-nowrap">
            Join Meeting Now <i class="fas fa-external-link-alt ml-2"></i>
        </a>
    </div>
    {% endif %}

    <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
        
        <div id="candidate-jobs" class="sortable-item bg-white/5 dark:bg-gray-800/40 rounded-xl shadow-lg border border-white/10 backdrop-blur-md animate-dynamic" style="animation-delay: 0.1s;">
            <div class="p-6 border-b border-white/5 flex justify-between items-center">
                <h2 class="text-xl font-bold text-white flex items-center drag-handle cursor-grab active:cursor-grabbing">
                    <i class="fas fa-briefcase text-green-400 mr-3"></i> Open Positions
                </h2>
                <span class="text-xs bg-white/10 text-gray-300 px-2 py-1 rounded">{{ open_jobs|length }} Available</span>
            </div>
            <div class="p-4 space-y-4 max-h-[500px] overflow-y-auto custom-scrollbar">
                {% for job in open_jobs %}
                    <div class="p-5 bg-white/5 hover:bg-white/10 rounded-lg border border-white/5 transition-all group">
                        <div class="flex justify-between items-start mb-2">
                            <h3 class="font-bold text-white text-lg group-hover:text-green-300 transition-colors">{{ job.title }}</h3>
                            {% if job.id in applied_job_ids %}
                                <span class="px-3 py-1 text-xs font-bold bg-green-500/20 text-green-400 rounded-full border border-green-500/30">
                                    <i class="fas fa-check mr-1"></i> Applied
                                </span>
                            {% else %}
                                <a href="{{ url_for('apply_job', job_id=job.id) }}" class="px-4 py-1.5 bg-indigo-600 hover:bg-indigo-500 text-white text-xs font-bold rounded-lg shadow transition-transform hover:-translate-y-0.5">
                                    Apply Now
                                </a>
                            {% endif %}
                        </div>
                        <p class="text-sm text-gray-400 mb-2 font-mono">ID: {{ job.job_id[:8] }}</p>
                        <p class="text-gray-300 text-sm line-clamp-2">{{ job.description }}</p>
                    </div>
                {% else %}
                    <div class="text-center py-10 text-gray-500">
                        <p>No open positions at the moment.</p>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div id="candidate-apps" class="sortable-item bg-white/5 dark:bg-gray-800/40 rounded-xl shadow-lg border border-white/10 backdrop-blur-md animate-dynamic" style="animation-delay: 0.2s;">
            <div class="p-6 border-b border-white/5">
                <h2 class="text-xl font-bold text-white flex items-center drag-handle cursor-grab active:cursor-grabbing">
                    <i class="fas fa-file-signature text-yellow-400 mr-3"></i> My Applications
                </h2>
            </div>
            <div class="p-4 space-y-3 max-h-[500px] overflow-y-auto custom-scrollbar">
                {% for app in my_applications %}
                    <div class="p-4 bg-white/5 rounded-lg border border-white/5 flex items-center justify-between">
                        <div>
                            <p class="font-semibold text-white">{{ app.job.title }}</p>
                            <p class="text-xs text-gray-500 mt-1">
                                <i class="far fa-calendar-alt mr-1"></i> {{ app.applied_at.strftime('%b %d, %Y') }}
                            </p>
                        </div>
                        <span class="px-3 py-1 text-xs font-bold uppercase tracking-wider rounded-full 
                            {% if app.status == 'pending' %}bg-yellow-500/20 text-yellow-400 border border-yellow-500/30
                            {% elif app.status == 'accepted' %}bg-green-500/20 text-green-400 border border-green-500/30
                            {% elif app.status == 'rejected' %}bg-red-500/20 text-red-400 border border-red-500/30{% endif %}">
                            {{ app.status }}
                        </span>
                    </div>
                {% else %}
                     <div class="text-center py-10 text-gray-500">
                        <p>You haven't applied for any jobs yet.</p>
                    </div>
                {% endfor %}
            </div>
        </div>
    </div>

    <div id="candidate-share-code" class="sortable-item bg-white/5 dark:bg-gray-800/40 rounded-xl shadow-lg border border-white/10 backdrop-blur-md animate-dynamic" style="animation-delay: 0.3s;">
        <div class="p-6 border-b border-white/5 bg-gradient-to-r from-purple-900/20 to-transparent">
            <h2 class="text-xl font-bold text-white flex items-center drag-handle cursor-grab active:cursor-grabbing">
                <i class="fas fa-code text-purple-400 mr-3"></i> Share Code Snippet
            </h2>
        </div>
        <div class="p-6">
            <form action="{{ url_for('share_code') }}" method="POST" class="space-y-6">
                <div>
                    <label for="code_recipient" class="block text-xs font-medium text-gray-400 uppercase mb-1">Recipient</label>
                    <select name="recipient_id" id="code_recipient" class="w-full md:w-1/2 px-4 py-2 rounded-lg bg-gray-900/50 border border-gray-600 text-white focus:ring-2 focus:ring-purple-500">
                        {% for user in messageable_users %}
                            <option class="bg-gray-800" value="{{ user.id }}">{{ user.username }} ({{ user.role.title() }})</option>
                        {% endfor %}
                    </select>
                </div>
                <div>
                    <label for="java_code" class="block text-xs font-medium text-gray-400 uppercase mb-1">Java Code</label>
                    <div class="relative">
                        <textarea name="java_code" id="java_code" rows="8" class="w-full px-4 py-3 font-mono text-sm bg-gray-900/80 border border-gray-600 rounded-lg text-gray-300 focus:ring-2 focus:ring-purple-500 focus:border-transparent custom-scrollbar" placeholder="public class Main { ... }"></textarea>
                        <div class="absolute top-2 right-2 text-xs text-gray-600 font-mono">Java</div>
                    </div>
                </div>
                <button type="submit" class="px-6 py-2 rounded-lg text-white bg-purple-600 hover:bg-purple-500 font-medium shadow-lg shadow-purple-600/20 transition-all transform hover:scale-[1.02]">
                    <i class="fas fa-share mr-2"></i> Share Code
                </button>
            </form>
        </div>
    </div>
</div>

<style>
    .custom-scrollbar::-webkit-scrollbar { width: 6px; }
    .custom-scrollbar::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); border-radius: 4px; }
    .custom-scrollbar::-webkit-scrollbar-thumb { background: rgba(255,255,255,0.15); border-radius: 4px; }
    .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: rgba(255,255,255,0.25); }
</style>
{% endblock %}