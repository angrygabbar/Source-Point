{% extends "layout.html" %}
{% block title %}Test Results - {{ assignment.test.title }}{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto space-y-6">

    <!-- Results Header -->
    <div class="glass-panel rounded-2xl p-8 border border-white/10 text-center">
        <div class="inline-flex items-center justify-center w-20 h-20 rounded-full mb-4"
            :class="'{{ 'bg-green-500/20 border-2 border-green-500' if result.percentage >= 70 else 'bg-yellow-500/20 border-2 border-yellow-500' if result.percentage >= 50 else 'bg-red-500/20 border-2 border-red-500' }}'">
            <i
                class="fas {{ 'fa-trophy' if result.percentage >= 70 else 'fa-star' if result.percentage >= 50 else 'fa-times' }} text-3xl {{ 'text-green-400' if result.percentage >= 70 else 'text-yellow-400' if result.percentage >= 50 else 'text-red-400' }}"></i>
        </div>

        <h1 class="text-3xl font-bold text-white mb-2">{{ assignment.test.title }}</h1>
        <p class="text-gray-400 mb-6">Test completed on {{ result.submitted_at.strftime('%B %d, %Y at %I:%M %p') }}</p>

        <!-- Score Display -->
        <div class="flex justify-center items-center gap-12 mb-6">
            <div>
                <p
                    class="text-5xl font-bold {{ 'text-green-400' if result.percentage >= 70 else 'text-yellow-400' if result.percentage >= 50 else 'text-red-400' }}">
                    {{ "%.1f"|format(result.percentage) }}%
                </p>
                <p class="text-sm text-gray-400 mt-2">Overall Score</p>
            </div>
            <div class="h-16 w-px bg-white/10"></div>
            <div>
                <p class="text-5xl font-bold text-white">
                    {{ result.score }}<span class="text-2xl text-gray-400">/{{ result.total_questions }}</span>
                </p>
                <p class="text-sm text-gray-400 mt-2">Correct Answers</p>
            </div>
        </div>

        <!-- Stats -->
        <div class="grid grid-cols-3 gap-4 mt-6">
            <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                <p class="text-2xl font-bold text-green-400">{{ result.score }}</p>
                <p class="text-xs text-gray-400 mt-1">Correct</p>
            </div>
            <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                <p class="text-2xl font-bold text-red-400">{{ result.total_questions - result.score }}</p>
                <p class="text-xs text-gray-400 mt-1">Incorrect</p>
            </div>
            <div class="bg-white/5 rounded-xl p-4 border border-white/10">
                <p class="text-2xl font-bold text-blue-400">{{ assignment.test.duration_minutes }}</p>
                <p class="text-xs text-gray-400 mt-1">Minutes</p>
            </div>
        </div>
    </div>

    <!-- Reviewer Info -->
    {% if assignment.reviewer %}
    <div class="glass-panel rounded-xl p-4 border border-white/10 flex items-center gap-3">
        <i class="fas fa-user-tie text-indigo-400 text-xl"></i>
        <div>
            <p class="text-sm text-gray-400">Reviewed by</p>
            <p class="text-white font-semibold">{{ assignment.reviewer.username }}</p>
        </div>
    </div>
    {% endif %}

    <!-- Question Review -->
    <div class="glass-panel rounded-2xl p-6 border border-white/10">
        <h2 class="text-xl font-bold text-white mb-6 flex items-center">
            <i class="fas fa-clipboard-list text-indigo-400 mr-3"></i>
            Answer Review
        </h2>

        <div class="space-y-4">
            {% for q in questions_data %}
            <div
                class="bg-white/5 rounded-xl p-5 border {{ 'border-green-500/30' if q.is_correct else 'border-red-500/30' }}">
                <div class="flex items-start gap-4">
                    <div
                        class="flex-shrink-0 w-10 h-10 rounded-full {{ 'bg-green-600/20 border border-green-500/50' if q.is_correct else 'bg-red-600/20 border border-red-500/50' }} flex items-center justify-center">
                        <i
                            class="fas {{ 'fa-check' if q.is_correct else 'fa-times' }} {{ 'text-green-400' if q.is_correct else 'text-red-400' }}"></i>
                    </div>

                    <div class="flex-1">
                        <p class="text-white font-medium mb-3">{{ q.question_text }}</p>

                        <div class="space-y-2">
                            {% for opt in q.options %}
                            <div class="flex items-center gap-2 p-3 rounded-lg
                                        {{ 'bg-green-600/20 border border-green-500/50' if opt.is_correct else 
                                           'bg-red-600/20 border border-red-500/50' if opt.is_selected and not opt.is_correct else 
                                           'bg-white/5 border border-white/10' }}">
                                <span
                                    class="text-sm font-bold {{ 'text-green-400' if opt.is_correct else 'text-red-400' if opt.is_selected else 'text-gray-400' }}">
                                    {{ opt.letter }})
                                </span>
                                <span
                                    class="text-sm {{ 'text-white' if opt.is_correct or opt.is_selected else 'text-gray-400' }}">
                                    {{ opt.text }}
                                </span>
                                {% if opt.is_correct %}
                                <span class="ml-auto text-xs text-green-400 font-bold">
                                    <i class="fas fa-check-circle mr-1"></i>Correct Answer
                                </span>
                                {% elif opt.is_selected %}
                                <span class="ml-auto text-xs text-red-400 font-bold">
                                    <i class="fas fa-times-circle mr-1"></i>Your Answer
                                </span>
                                {% endif %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Back Button -->
    <div class="text-center pb-8">
        <a href="{{ url_for('candidate.candidate_dashboard') }}"
            class="inline-flex items-center px-6 py-3 bg-white/5 hover:bg-white/10 border border-white/10 text-white rounded-xl font-medium transition-all">
            <i class="fas fa-arrow-left mr-2"></i> Back to Dashboard
        </a>
    </div>

</div>
{% endblock %}