{% extends "layout.html" %}
{% block title %}Developer Workspace{% endblock %}
{% block content %}

<div class="space-y-6 animate-fade-in">
    
    <div class="flex flex-col md:flex-row justify-between items-end gap-4">
        <div>
            <h1 class="text-3xl font-bold text-white tracking-tight">DevOps Console</h1>
            <p class="text-gray-400 text-sm mt-1">Coordinate with the team and manage code snippets.</p>
        </div>
        <div class="flex space-x-2">
            <span class="px-3 py-1 rounded-full bg-emerald-500/10 text-emerald-400 text-xs font-bold border border-emerald-500/20 flex items-center">
                <span class="w-2 h-2 rounded-full bg-emerald-500 mr-2 animate-pulse"></span> Systems Online
            </span>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 h-[calc(100vh-12rem)]">
        
        <div class="lg:col-span-2 flex flex-col space-y-6 h-full">
            
            <div class="glass-panel p-4 rounded-xl">
                <form action="{{ url_for('developer.developer_dashboard') }}" method="POST"
                      hx-post="{{ url_for('developer.developer_dashboard') }}"
                      hx-target="#main-content" hx-select="#main-content" hx-swap="outerHTML"
                      id="activity-form" class="flex gap-4">
                    <div class="flex-shrink-0 hidden sm:block">
                        <img src="{{ current_user.avatar_url }}" class="w-10 h-10 rounded-lg border border-gray-600">
                    </div>
                    <div class="flex-1 relative">
                        <input type="text" name="activity_content" required 
                               class="w-full bg-black/20 border border-white/10 rounded-lg px-4 py-3 text-white placeholder-gray-500 focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition-all" 
                               placeholder="Log a status update or commit message...">
                        <button type="submit" id="post-update-btn" class="absolute right-2 top-2 p-1.5 text-indigo-400 hover:text-white hover:bg-indigo-600 rounded-md transition-all">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                </form>
            </div>

            <div class="glass-panel rounded-xl flex-1 overflow-hidden flex flex-col">
                <div class="p-4 border-b border-white/5 bg-white/5 flex justify-between items-center">
                    <h3 class="font-bold text-white text-sm uppercase tracking-wide flex items-center">
                        <i class="fas fa-stream text-blue-400 mr-2"></i> Engineering Log
                    </h3>
                </div>
                <div class="p-4 overflow-y-auto custom-scrollbar space-y-6 flex-1">
                    {% for activity in activities %}
                    <div class="flex gap-4 group">
                        <div class="flex-col items-center hidden sm:flex">
                            <img src="{{ activity.author.avatar_url }}" class="w-10 h-10 rounded-full border border-gray-700 group-hover:border-indigo-500 transition-colors">
                            <div class="w-0.5 h-full bg-white/5 my-2 group-last:hidden"></div>
                        </div>
                        <div class="flex-1">
                            <div class="flex items-baseline justify-between">
                                <span class="text-sm font-bold text-white">{{ activity.author.username }}</span>
                                <span class="text-[10px] text-gray-500 font-mono">{{ activity.timestamp.strftime('%Y-%m-%d %H:%M') }}</span>
                            </div>
                            <div class="mt-1 p-3 rounded-lg bg-white/5 border border-white/5 text-gray-300 text-sm leading-relaxed group-hover:bg-white/10 transition-colors">
                                {{ activity.content }}
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="text-center py-12 text-gray-500">
                        <i class="fas fa-terminal text-3xl mb-3 opacity-30"></i>
                        <p class="text-sm">No logs found. Initialize the feed.</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>

        <div class="glass-panel rounded-xl overflow-hidden flex flex-col h-full border-l-4 border-l-purple-500/50">
            <div class="p-4 border-b border-white/5 bg-gradient-to-r from-purple-900/20 to-transparent flex justify-between items-center">
                <h3 class="font-bold text-white text-sm uppercase tracking-wide flex items-center">
                    <i class="fas fa-code-branch text-purple-400 mr-2"></i> Snippets
                </h3>
                <span class="text-xs bg-white/10 px-2 py-0.5 rounded text-gray-300">{{ received_snippets|length }}</span>
            </div>
            
            <div class="p-3 space-y-3 overflow-y-auto custom-scrollbar flex-1 bg-[#0d1117]">
                {% for snippet in received_snippets %}
                <div class="group rounded-lg border border-gray-800 bg-[#161b22] hover:border-purple-500/30 transition-all overflow-hidden flex flex-col">
                    <div class="px-3 py-2 border-b border-gray-800 flex justify-between items-center bg-[#21262d]">
                        <div class="flex items-center gap-2">
                            <span class="text-xs font-mono text-purple-300">@{{ snippet.snippet_sender.username }}</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <span class="text-[10px] text-gray-500">{{ snippet.timestamp.strftime('%b %d') }}</span>
                            <a hx-get="{{ url_for('candidate.delete_snippet', snippet_id=snippet.id) }}" 
                               hx-confirm="Delete this code snippet?"
                               hx-target="#main-content" hx-select="#main-content" hx-swap="outerHTML"
                               class="text-gray-500 hover:text-red-400 transition-colors opacity-0 group-hover:opacity-100 cursor-pointer">
                                <i class="fas fa-trash-alt text-xs"></i>
                            </a>
                        </div>
                    </div>
                    <div class="relative group-hover:bg-[#0d1117] transition-colors">
                        <pre class="p-3 text-[10px] font-mono text-gray-300 overflow-x-auto custom-scrollbar max-h-32"><code class="language-{{ snippet.language }}">{{ snippet.code }}</code></pre>
                        <button class="absolute top-2 right-2 bg-white/10 hover:bg-white/20 p-1 rounded text-xs text-white opacity-0 group-hover:opacity-100 transition-opacity" onclick="navigator.clipboard.writeText(this.parentElement.innerText)" title="Copy">
                            <i class="far fa-copy"></i>
                        </button>
                    </div>
                </div>
                {% else %}
                <div class="flex flex-col items-center justify-center h-full text-gray-600">
                    <i class="fas fa-code text-2xl mb-2 opacity-50"></i>
                    <p class="text-xs">Repository empty.</p>
                </div>
                {% endfor %}
            </div>
        </div>

    </div>
</div>
{% endblock %}