{% extends "layout.html" %}
{% block title %}System Records{% endblock %}
{% block content %}

<div class="space-y-8 animate-fade-in pb-20" x-data="{ currentTab: 'jobs' }">
    
    <div class="flex flex-col md:flex-row justify-between items-end gap-6 border-b border-white/5 pb-8">
        <div>
            <h1 class="text-4xl font-extrabold text-white tracking-tight">System Records</h1>
            <p class="text-gray-400 text-sm mt-2">Archives for jobs, feedback, code submissions, and assignment history.</p>
        </div>
        
        <div class="flex bg-black/20 p-1 rounded-xl border border-white/5 backdrop-blur-md">
            <button @click="currentTab = 'jobs'" :class="currentTab === 'jobs' ? 'bg-indigo-600 text-white shadow-lg' : 'text-gray-400 hover:text-white hover:bg-white/5'" class="px-4 py-2 rounded-lg text-sm font-bold transition-all">
                Jobs
            </button>
            <button @click="currentTab = 'feedback'" :class="currentTab === 'feedback' ? 'bg-indigo-600 text-white shadow-lg' : 'text-gray-400 hover:text-white hover:bg-white/5'" class="px-4 py-2 rounded-lg text-sm font-bold transition-all">
                Feedback
            </button>
            <button @click="currentTab = 'submissions'" :class="currentTab === 'submissions' ? 'bg-indigo-600 text-white shadow-lg' : 'text-gray-400 hover:text-white hover:bg-white/5'" class="px-4 py-2 rounded-lg text-sm font-bold transition-all">
                Code Tests
            </button>
            <button @click="currentTab = 'history'" :class="currentTab === 'history' ? 'bg-indigo-600 text-white shadow-lg' : 'text-gray-400 hover:text-white hover:bg-white/5'" class="px-4 py-2 rounded-lg text-sm font-bold transition-all">
                History
            </button>
        </div>
    </div>

    <div x-show="currentTab === 'jobs'" class="glass-panel rounded-2xl overflow-hidden border border-white/10" x-transition.opacity>
        <div class="p-6 border-b border-white/5 flex justify-between items-center">
            <h3 class="font-bold text-white">Active Job Openings</h3>
            <span class="text-xs text-gray-500 bg-white/5 px-2 py-1 rounded">{{ jobs|length }} Records</span>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-left text-sm text-gray-400">
                <thead class="bg-black/20 text-xs uppercase font-bold text-gray-500">
                    <tr>
                        <th class="px-6 py-4">Title</th>
                        <th class="px-6 py-4">Description</th>
                        <th class="px-6 py-4">Posted Date</th>
                        <th class="px-6 py-4 text-right">Action</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    {% for job in jobs %}
                    <tr id="job-{{ job.id }}" class="hover:bg-white/5 transition-colors">
                        <td class="px-6 py-4 font-medium text-white">{{ job.title }}</td>
                        <td class="px-6 py-4 truncate max-w-xs">{{ job.description }}</td>
                        <td class="px-6 py-4">{{ job.created_at.strftime('%Y-%m-%d') }}</td>
                        <td class="px-6 py-4 text-right">
                            <button data-url="{{ url_for('admin_hiring.delete_job_opening', job_id=job.id) }}" 
                                    onclick="handleAjaxUrl(event, this.dataset.url, 'Delete this job opening?')"
                                    class="text-red-400 hover:text-red-300 transition-colors p-2 rounded hover:bg-red-500/10">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="4" class="px-6 py-8 text-center text-gray-500 italic">No job openings found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div x-show="currentTab === 'feedback'" class="glass-panel rounded-2xl overflow-hidden border border-white/10" x-cloak x-transition.opacity>
        <div class="p-6 border-b border-white/5 flex justify-between items-center">
            <h3 class="font-bold text-white">Interview Feedback</h3>
            <span class="text-xs text-gray-500 bg-white/5 px-2 py-1 rounded">{{ feedback|length }} Records</span>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-left text-sm text-gray-400">
                <thead class="bg-black/20 text-xs uppercase font-bold text-gray-500">
                    <tr>
                        <th class="px-6 py-4">Candidate</th>
                        <th class="px-6 py-4">Moderator</th>
                        <th class="px-6 py-4">Rating</th>
                        <th class="px-6 py-4">Comments</th>
                        <th class="px-6 py-4 text-right">Action</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    {% for feed in feedback %}
                    <tr id="feed-{{ feed.id }}" class="hover:bg-white/5 transition-colors">
                        <td class="px-6 py-4 font-medium text-white">{{ feed.candidate.username }}</td>
                        <td class="px-6 py-4">{{ feed.moderator.username }}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 rounded text-xs font-bold 
                                {% if feed.rating >= 4 %}bg-green-500/20 text-green-400
                                {% elif feed.rating == 3 %}bg-yellow-500/20 text-yellow-400
                                {% else %}bg-red-500/20 text-red-400{% endif %}">
                                {{ feed.rating }}/5
                            </span>
                        </td>
                        <td class="px-6 py-4 truncate max-w-xs">{{ feed.remarks }}</td>
                        <td class="px-6 py-4 text-right">
                            <button data-url="{{ url_for('admin_hiring.delete_feedback', feedback_id=feed.id) }}" 
                                    onclick="handleAjaxUrl(event, this.dataset.url, 'Delete this feedback?')"
                                    class="text-red-400 hover:text-red-300 transition-colors p-2 rounded hover:bg-red-500/10">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="5" class="px-6 py-8 text-center text-gray-500 italic">No feedback records found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div x-show="currentTab === 'submissions'" class="glass-panel rounded-2xl overflow-hidden border border-white/10" x-cloak x-transition.opacity>
        <div class="p-6 border-b border-white/5 flex justify-between items-center">
            <h3 class="font-bold text-white">Code Test Submissions</h3>
            <span class="text-xs text-gray-500 bg-white/5 px-2 py-1 rounded">{{ submissions|length }} Records</span>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-left text-sm text-gray-400">
                <thead class="bg-black/20 text-xs uppercase font-bold text-gray-500">
                    <tr>
                        <th class="px-6 py-4">Candidate</th>
                        <th class="px-6 py-4">Language</th>
                        <th class="px-6 py-4">Submitted At</th>
                        <th class="px-6 py-4">Output Preview</th>
                        <th class="px-6 py-4 text-right">Action</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    {% for sub in submissions %}
                    <tr id="sub-{{ sub.id }}" class="hover:bg-white/5 transition-colors">
                        <td class="px-6 py-4 font-medium text-white">{{ sub.candidate.username }}</td>
                        <td class="px-6 py-4">
                            <span class="px-2 py-1 bg-blue-500/10 text-blue-400 rounded text-xs font-mono border border-blue-500/20">{{ sub.language }}</span>
                        </td>
                        <td class="px-6 py-4">{{ sub.submitted_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td class="px-6 py-4 font-mono text-xs text-gray-500 truncate max-w-xs">{{ sub.output[:50] }}...</td>
                        <td class="px-6 py-4 text-right">
                            <button data-url="{{ url_for('admin_hiring.delete_submission_record', submission_id=sub.id) }}" 
                                    onclick="handleAjaxUrl(event, this.dataset.url, 'Delete this submission?')"
                                    class="text-red-400 hover:text-red-300 transition-colors p-2 rounded hover:bg-red-500/10">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="5" class="px-6 py-8 text-center text-gray-500 italic">No code submissions found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <div x-show="currentTab === 'history'" class="glass-panel rounded-2xl overflow-hidden border border-white/10" x-cloak x-transition.opacity>
        <div class="p-6 border-b border-white/5 flex justify-between items-center">
            <h3 class="font-bold text-white">Moderator Assignment History</h3>
            <span class="text-xs text-gray-500 bg-white/5 px-2 py-1 rounded">{{ history|length }} Records</span>
        </div>
        <div class="overflow-x-auto">
            <table class="w-full text-left text-sm text-gray-400">
                <thead class="bg-black/20 text-xs uppercase font-bold text-gray-500">
                    <tr>
                        <th class="px-6 py-4">Candidate</th>
                        <th class="px-6 py-4">Assigned Moderator</th>
                        <th class="px-6 py-4">Problem Statement</th>
                        <th class="px-6 py-4">Assigned At</th>
                        <th class="px-6 py-4 text-right">Action</th>
                    </tr>
                </thead>
                <tbody class="divide-y divide-white/5">
                    {% for record in history %}
                    <tr id="hist-{{ record.id }}" class="hover:bg-white/5 transition-colors">
                        <td class="px-6 py-4 font-medium text-white">{{ record.candidate.username }}</td>
                        <td class="px-6 py-4">{{ record.moderator.username }}</td>
                        <td class="px-6 py-4 text-indigo-400">{{ record.problem.title if record.problem else 'N/A' }}</td>
                        <td class="px-6 py-4">{{ record.assigned_at.strftime('%Y-%m-%d %H:%M') }}</td>
                        <td class="px-6 py-4 text-right">
                            <button data-url="{{ url_for('admin_hiring.delete_assignment_history', history_id=record.id) }}" 
                                    onclick="handleAjaxUrl(event, this.dataset.url, 'Delete this history record?')"
                                    class="text-red-400 hover:text-red-300 transition-colors p-2 rounded hover:bg-red-500/10">
                                <i class="fas fa-trash-alt"></i>
                            </button>
                        </td>
                    </tr>
                    {% else %}
                    <tr><td colspan="5" class="px-6 py-8 text-center text-gray-500 italic">No assignment history found.</td></tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

</div>
{% endblock %}